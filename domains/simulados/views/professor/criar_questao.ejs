<!DOCTYPE html>
<html lang="pt-br"> 

<head>
    <meta charset="UTF-8">
    <title>Criar questão - IFVest</title>

    <link rel="stylesheet" href="/simulados/css/professor/editordropdown.css">
    <link rel="stylesheet" href="/simulados/css/professor/editor_equacao.css">
    <link rel="stylesheet" href="/simulados/css/global.css">
    <link rel="stylesheet" href="/simulados/css/professor/questao.css">

    <!-- Partial que inclui bibliotecas como Quill e UIkit -->
    <%- include('../partials/quill_and_uikit') %>
</head>

<body>
    <!-- Overlay para carregamento ou modais -->
    <div class="overlay" id="overlay"></div>

    <div class="container">
        <!-- Spinner de carregamento com acessibilidade -->
        <div id="loading-container"
            style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 9999;">
            <div class="spinner" role="status" aria-label="Carregando"></div>
            Carregando...
        </div>

        <!-- Título principal da página -->
        <h1 class="title">Criar Questão</h1>
        <hr class="uk-divider-icon">

        <!-- Exibe mensagem de erro, se houver -->
        <% if (typeof errorMessage !== 'undefined' && errorMessage.trim()) { %>
            <script>
                window.onload = function () {
                    alert("<%= errorMessage %>");
                };
            </script>
        <% } %>

        <!-- Formulário principal para criação da questão -->
        <form action="/simulados/registrar-questao/<%= tipo %>" method="POST">
            <!-- Campo de título com rótulo associado -->
            <div class="titulo">
                <label for="titulo">Título:</label>
                <input type="text" id="titulo" name="titulo" placeholder="Exemplo: Questão 32 (Enem 2022)" required maxlength="100">
            </div>

          
            <%- include('../partials/editor_equacao') %>

           
            <% if (tipo === "objetiva") { %>
                <%- include('../partials/resposta_objetiva') %>
            <% } else { %>
                <%- include('../partials/resposta_dissertativa') %>
            <% } %>

            <!-- Campos ocultos para armazenar dados internos, marcados como aria-hidden -->
            <textarea id="pergunta" name="pergunta" rows="5" cols="50" aria-hidden="true" hidden></textarea>
            <textarea id="respostasSelecionadas" name="respostasSelecionadas" rows="5" cols="50" aria-hidden="true" hidden></textarea>
            <textarea id="respostas" name="respota" rows="5" cols="50" aria-hidden="true" hidden></textarea>

            <!-- Seção de seleção de resposta correta e área temática -->
            <div>
                <br>
                <div uk-grid>
                    <% if (tipo === "objetiva") { %>
                    
                        <label for="correta">Selecione a opção correta:</label>
                        <select name="correta" id="correta" required>
                            <option value="">Selecione uma opção</option>
                            <option value="A">Opção A</option>
                            <option value="B">Opção B</option>
                            <option value="C">Opção C</option>
                            <option value="D">Opção D</option>
                            <option value="E">Opção E</option>
                        </select>
                    <% } %>

                    <!-- Campo de seleção de área -->
                    <div>
                        <h4>Área e Tópicos</h4>
                        <label for="areaId">Selecione uma área:</label>
                        <select name="areaId" id="areaId" required>
                            <option value="">Selecione uma opção</option>
                            <% Areas.forEach(area => { %>
                                <option value="<%= area.id_area %>"><%= area.nome %></option>
                            <% }); %>
                        </select>
                    </div>

                    <!-- Campo de busca com suporte a acessibilidade: label associada, região com aria-label e lista com role="listbox" -->
 -->
                    <label for="search">Pesquisar tópico:</label>
                    <div class="dropdown" id="topicosSearchContainer" role="region" aria-label="Busca de tópicos">
                        <input type="text" id="search" placeholder="Pesquisar..." maxlength="100" tabindex="0">
                        <ul id="dropdown-list" role="listbox" tabindex="0">
                            <!-- Tópicos serão inseridos dinamicamente via JS -->
                        </ul>
                    </div>

                    <!-- Link para criar novo tópico com prevenção de comportamento padrão -->
                    <a href="#" onclick="event.preventDefault(); showCreateTopicModal();" id="create-topic-link" tabindex="0">
                        Não encontrou o tópico que procura? Clique aqui para criar um novo tópico
                    </a>
                </div>
            </div>

            
            <div class="button-container">
                <button type="submit" class="botao-registro">Registrar</button>
            </div>
        </form>
        
        <%- include('../partials/modal_topicos') %>

       
        <script src="/simulados/js/professor/initializeQuill.js"></script>
        <script src="/simulados/js/professor/editor.js"></script>
        <script src="/simulados/js/main.js"></script>
        <script src="/simulados/js/professor/dropdown.js"></script>
        <script src="/simulados/js/professor/editorInputs.js"></script>
        <script type="module" src="/simulados/js/index.js"></script>
        <script src="/simulados/js/professor/criarQuestao.js"></script>

        <!-- Inicializar os editores com base no tipo da questão -->
        <script>
            initializeQuestionEditors(<%- JSON.stringify(tipo) %>);
        </script>
    </div>
</body>

</html>
