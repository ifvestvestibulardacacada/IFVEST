<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/css/simulado/criar_simulado.css">
  <%- include('../partials/quill_and_uikit') %>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <title>Criar Simulado - IFVest</title>
</head>

<body>
  <% if (typeof errorMessage !== 'undefined' && errorMessage.trim()) { %>
    <!-- Feedback de erro exibido ao carregar a página -->
    <script>
      window.onload = function() {
        alert("<%= errorMessage %>");
      };
    </script>
  <% } %>

  <!-- Adicionado <main> para conteúdo principal da página -->
  <main>
    
    <section class="form-container" id="formSection">
      <h1>Criar Simulado</h1>

      <form id="simuladoForm" action="/api/simulado" method="POST">
        <!-- Labels associados corretamente aos inputs com for/id -->
        <label for="titulo">Título do Simulado:</label>
        <input type="text" id="titulo" name="titulo" required maxlength="100">

        <label for="descricao">Descrição:</label>
        <textarea id="descricao" name="descricao" rows="5" required maxlength="1000"></textarea>

        <label for="tipo">Selecione o tipo:</label>
        <select name="tipo" id="tipo" required>
          <option value="Aleatorio" selected>Aleatória</option>
          <option value="Dissertativo">Dissertativa</option>
          <option value="Objetivo">Objetiva</option>
        </select>

        <label for="modo">Selecione o Modo:</label>
        <select name="modo" id="modo" required>
          <option value="1">Normal</option>
          <option value="2">Aleatório</option>
        </select>

      
        <input type="hidden" name="selectedQuestionIds" id="selectedQuestionIds">

        <!-- Botão com aria-label para descrever sua função -->
        <button type="button" onclick="goToNewContent()" aria-label="Ir para seção de adicionar questões">Adicionar Questões</button>
      </form>
    </section>

    <!-- Seção para associar questões ao simulado -->
    <section class="new-content" id="newContentSection">
      <h1 class="uk-heading-divider">Associar Questões</h1>

      <div class="filter-container">
        <!-- Campo de filtro com aria-label para leitores de tela -->
        <input type="text" name="tituloFiltro" id="tituloFiltro" placeholder="Filtrar por título" aria-label="Campo para filtrar questões por título">

        <!-- Botão com aria-label para descrever sua ação -->
        <button class="botaoFiltro" onclick="applyFilters()" aria-label="Aplicar filtro de título">Filtrar</button>
      </div>

      <!-- Adicionado aria-live para que leitores de tela anunciem mudanças no contador -->
      <div id="contador-questoes-selecionadas" aria-live="polite">
        Questões Selecionadas: <span id="numero-questoes-selecionadas">0</span>
      </div>

    <div class="table-container">
  <table class="uk-table uk-table-striped" id="questoesTable" aria-describedby="tabela-instrucoes">
    <caption class="sr-only">Tabela de questões disponíveis para associação ao simulado</caption>
    <thead>
      <tr>
        <th scope="col" id="col-selecionar">
          <input type="checkbox" id="selectAll" aria-label="Selecionar todas as questões">
        </th>
        <th scope="col" id="col-titulo">Título</th>
        <th scope="col" id="col-tipo">Tipo</th>
        <th scope="col" id="col-questao">Questão</th>
        <th scope="col" id="col-topico">Tópico</th>
      </tr>
    </thead>
    <tbody id="questoesBody">
      <% questoes.forEach(questao => {
           const idUnico = `${questao.id_questao}-${questao.ano || 'ano'}`; %>
        <tr>
          <td headers="col-selecionar">
            <input
              type="checkbox"
              class="questao-checkbox"
              name="questoesSelecionadas"
              value="<%= idUnico %>"
              id="questao-<%= idUnico %>"
              aria-labelledby="titulo-<%= idUnico %> tipo-<%= idUnico %> pergunta-<%= idUnico %> topico-<%= idUnico %>"
              title="Selecionar questão: <%= questao.titulo || 'Sem título' %> (<%= questao.ano || 'Ano desconhecido' %>)"
            />
          </td>
          <td id="titulo-<%= idUnico %>" headers="col-titulo"><%= questao.titulo || 'Sem título' %></td>
          <td id="tipo-<%= idUnico %>" headers="col-tipo"><%= questao.tipo || 'Sem tipo' %></td>
          <td id="pergunta-<%= idUnico %>" headers="col-questao">
            <div class="name"><%= questao.pergunta || 'Sem pergunta' %></div>
          </td>
          <td id="topico-<%= idUnico %>" headers="col-topico">
            <% if (questao.Topico && questao.Topico.length > 0) { %>
              <%= questao.Topico.map(t => t.nome).join(', ') %>
            <% } else { %>
              Sem tópico
            <% } %>
          </td>
        </tr>
      <% }); %>
    </tbody>
  </table>
</div>

<div id="tabela-instrucoes" class="sr-only">
  Use Tab para navegar entre as células e barra de espaço para selecionar questões.
</div>


<!-- Instrução oculta para leitores de tela -->
<div id="tabela-instrucoes" class="sr-only">
  Use Tab para navegar entre as células e barra de espaço para selecionar questões.
</div>


      <div class="pagination" id="pagination"></div>

      <div class="button-container">
        <!-- Botões com aria-label para descrever suas ações -->
        <button type="button" class="voltar-btn" onclick="goBack()" aria-label="Voltar para o formulário">Voltar</button>
        <button type="button" id="submitButton" class="salvar-btn" onclick="saveSimulado()" aria-label="Salvar simulado com questões selecionadas">Salvar</button>
      </div>
    </section>
  </main>

  
  <script>
    window.questoes = <%- JSON.stringify(questoes || []) %>;
    console.log('Questoes:', window.questoes);
  </script>
  <script src="/simulados/js/simulado/criarSimulado.js"></script>
  <script src="/js/main.js"></script>
  <script src="/js/validations/validate.js"></script>
</body>
</html>

