<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
  <link rel="stylesheet" href="/css/global.css">
  <link rel="stylesheet" href="/simulados/css/simulado/criar_simulado.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <%- include('../partials/libs') %>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <title>Criar Simulado - IFVest</title>
</head>

<body>
  <% if (typeof errorMessage !== 'undefined' && errorMessage.trim()) { %>
    <script>
      window.onload = function () {
        alert("<%= errorMessage %>");
      };
    </script>
  <% } %>

  <main>
    <div class="form-container" id="formSection">
      <h1>Criar Simulado</h1>
      <form id="simuladoForm" action="/api/simulado" method="POST">

        <div class="form-group">
          <div class="error-message" id="titulo-error"></div>
          <label for="titulo">Título do Simulado:</label>
          <input type="text" id="titulo" name="titulo" required maxlength="200" aria-describedby="titulo-error">
        </div>

        <div class="form-group">
          <div class="error-message" id="descricao-error"></div>
          <label for="descricao">Descrição:</label>
          <textarea id="descricao" name="descricao" rows="5" required maxlength="1000" aria-describedby="descricao-error"></textarea>
        </div>

        <div class="form-group">
          <label for="tipo">Selecione o tipo:</label>
          <select name="tipo" id="tipo" required aria-describedby="tipo-error">
            <option value="Aleatorio" selected>Aleatória</option>
            <option value="Dissertativo">Dissertativa</option>
            <option value="Objetivo">Objetiva</option>
          </select>
          <div class="error-message" id="tipo-error"></div>
        </div>

        <input type="hidden" name="selectedQuestionIds" id="selectedQuestionIds">

        <!-- Botão com aria-label -->
        <button type="button" id="addQuestionsButton" onclick="goToNewContent()" aria-label="Ir para seção de adicionar questões">Adicionar Questões</button>

        <div class="button-container">
          <a href="/simulados" class="btn btn-voltar btn-lg" aria-label="Voltar ao menu de simulados">
            <i class="bi bi-arrow-left"></i> Voltar ao Menu Simulados
          </a>
        </div>
      </form>
    </div>

    <div class="new-content" id="newContentSection" style="display: none;">
      <h1 class="border-bottom pb-2 mb-4">Associar Questões</h1>

      <% if (typeof errorMessage !== 'undefined' && errorMessage.trim()) { %>
        <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          <div><%= errorMessage %></div>
        </div>
      <% } %>

      <!-- Filtro -->
      <div class="filter-container mb-4">
        <div class="row g-2 align-items-center">
          <div class="col-md-10">
            <input type="text" id="tituloFiltro" class="form-control" placeholder="Filtrar por título" aria-label="Campo para filtrar questões por título">
          </div>
          <div class="col-md-2">
            <button type="button" class="btn btn-success d-flex align-items-center justify-content-center" onclick="applyFilters()" aria-label="Aplicar filtro de título">
              <i class="bi bi-search me-1"></i> Filtrar
            </button>
          </div>
        </div>
      </div>

      <!-- Contador com aria-live -->
      <div id="contador-questoes-selecionadas" class="contador-questoes mb-3" aria-live="polite">
        Questões Selecionadas: <span id="numero-questoes-selecionadas">0</span>
      </div>

      <!-- Tabela -->
      <div class="table-container">
        <div class="table-responsive">
          <table class="table table-striped table-bordered align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th scope="col" width="5%">
                  <input type="checkbox" id="selectAll" class="form-check-input" aria-label="Selecionar todas as questões">
                </th>
                <th scope="col">Título</th>
                <th scope="col" width="12%">Tipo</th>
                <th scope="col" width="45%">Questão</th>
                <th scope="col" width="15%">Tópico(s)</th>
              </tr>
            </thead>
            <tbody id="questoes-tbody"></tbody>
          </table>
        </div>
      </div>

      <!-- Paginação -->
      <nav aria-label="Paginação de questões" class="mt-3">
        <ul class="pagination justify-content-center" id="pagination"></ul>
      </nav>

      <!-- Botões -->
      <div class="button-container d-flex justify-content-center gap-3 mt-4">
        <button type="button" class="btn btn-secondary btn-lg" onclick="goBack()" aria-label="Voltar para o formulário">
          <i class="bi bi-arrow-left"></i> Voltar
        </button>
        <button type="button" id="submitButton" class="btn btn-success btn-lg" onclick="saveSimulado()" aria-label="Salvar simulado com questões selecionadas">
          <i class="bi bi-check-lg"></i> Salvar
        </button>
      </div>
    </div>
  </main>

  <%- include('../partials/ContentManager') %>
  <script src="/simulados/js/simulado/criarSimulado.js"></script>
  <script src="/simulados/js/simulado/validate_criar_simulados.js"></script>
  <script src="/js/main.js"></script>
  <script src="/simulados/js/validate.js"></script>
</body>
</html>

