<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meus Simulados - IFVest</title>
   
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="/simulados/css/simulado/meus_simulados.css">
    <link rel="stylesheet" href="/simulados/css/simulado/removerquestoes.css">
</head>

<body>
    <div class="container col-lg-10 mx-auto my-4">

        <!-- Mensagem de erro -->
        <% if (typeof errorMessage !== 'undefined' && errorMessage.trim()) { %>
            <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                <i class="bi bi-exclamation-triangle-fill me-2"></i>
                <div><%= errorMessage %></div>
            </div>
        <% } %>

        <!-- Título -->
        <h1 class="border-bottom pb-2 mb-4">Meus Simulados</h1>

        <!-- Filtro -->
        <div class="filter-container">
            <form method="GET" action="/simulados/meus-simulados" class="row g-3 align-items-end">
                <div class="col-md-10">
                    <label for="titulo" class="form-label">Buscar por título</label>
                    <input type="text" id="titulo" name="titulo" placeholder="Filtrar por título" 
                           class="form-control" maxlength="100" value="<%= typeof titulo !== 'undefined' ? titulo : '' %>">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-search" aria-hidden="true"></i> Pesquisar
                    </button>
                </div>
            </form>
        </div>

        <!-- Tabela -->
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-striped table-bordered align-middle mb-0" role="table" aria-label="Lista de simulados disponíveis">
                    <thead class="table-light">
                        <tr>
                            <th id="colTitulo" scope="col">Título</th>
                            <th id="colTipo" scope="col">Tipo</th>
                            <th id="colAcoes" scope="col" width="55%">Ações</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% simulados.forEach(simulado => { %>
                            <tr>
                                <td headers="colTitulo" data-bs-toggle="tooltip" data-bs-placement="top" title="<%= simulado.descricao %>" aria-describedby="descricao<%= simulado.id_simulado %>">
                                    <span tabindex="0"><%= simulado.titulo %></span>
                                    <span id="descricao<%= simulado.id_simulado %>" class="visually-hidden">
                                        <%= simulado.descricao %>
                                    </span>
                                </td>
                                <td headers="colTipo">
                                    <span tabindex="0"><%= simulado.tipo %></span>
                                </td>
                                <td headers="colAcoes">
                                    <div class="d-flex gap-2 flex-wrap">
                                        <a href="/simulados/<%= simulado.id_simulado %>/fazer"
                                           class="btn btn-outline-success btn-sm" aria-label="Fazer simulado <%= simulado.titulo %>">
                                            <i class="bi bi-play" aria-hidden="true"></i> Fazer
                                        </a>
                                        <a href="/simulados/<%= simulado.id_simulado %>/editar"
                                           class="btn btn-outline-primary btn-sm" aria-label="Editar simulado <%= simulado.titulo %>">
                                            <i class="bi bi-pencil" aria-hidden="true"></i> Editar
                                        </a>
                                        <a href="/simulados/<%= simulado.id_simulado %>/imprimir"
                                           class="btn btn-outline-dark btn-sm generate-pdf"
                                           data-simulado-id="<%= simulado.id_simulado %>" aria-label="Visualizar PDF do simulado <%= simulado.titulo %>">
                                            <i class="bi bi-file-earmark-pdf" aria-hidden="true"></i> PDF
                                        </a>
                                        <a href="/simulados/<%= simulado.id_simulado %>/remover-questoes"
                                           class="btn btn-outline-dark btn-sm" aria-label="Remover questões do simulado <%= simulado.titulo %>">
                                            <i class="bi bi-dash" aria-hidden="true"></i> Remover
                                        </a>
                                        <a href="/simulados/<%= simulado.id_simulado %>/adicionar-questoes"
                                           class="btn btn-outline-dark btn-sm" aria-label="Adicionar questões ao simulado <%= simulado.titulo %>">
                                            <i class="bi bi-plus" aria-hidden="true"></i> Adicionar
                                        </a>
                                        <a href="#" class="btn btn-outline-danger btn-sm delete-simulado"
                                           data-simulado-id="<%= simulado.id_simulado %>" aria-label="Excluir simulado <%= simulado.titulo %>">
                                            <i class="bi bi-trash" aria-hidden="true"></i> Excluir
                                        </a>
                                        <form id="deleteForm<%= simulado.id_simulado %>"
                                              action="/simulados/<%= simulado.id_simulado %>?_method=DELETE"
                                              method="POST" style="display: none;"></form>
                                    </div>
                                </td>
                            </tr>
                        <% }); %>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Paginação -->
        <% if (totalPages > 1) { %>
            <div id="pagination-container" class="pagination-custom">
                <nav aria-label="Paginação de simulados">
                    <% if (currentPage > 1) { %>
                        <a href="?page=1&titulo=<%= typeof titulo !== 'undefined' ? titulo : '' %>" class="btn btn-outline-secondary" aria-label="Ir para primeira página">Primeira</a>
                        <a href="?page=<%= currentPage - 1 %>&titulo=<%= typeof titulo !== 'undefined' ? titulo : '' %>" class="btn btn-outline-secondary" aria-label="Ir para página anterior">Anterior</a>
                    <% } %>

                    <% 
                        const startPage = Math.max(1, currentPage - 2);
                        const endPage = Math.min(totalPages, currentPage + 2);
                        for(let i = startPage; i <= endPage; i++) { 
                    %>
                        <a href="?page=<%= i %>&titulo=<%= typeof titulo !== 'undefined' ? titulo : '' %>"
                           class="btn <%= currentPage == i ? 'btn-primary' : 'btn-outline-secondary' %>"
                           aria-label="Ir para página <%= i %>"
                           <%= currentPage == i ? 'aria-current="page"' : '' %>>
                            <%= i %>
                        </a>
                    <% } %>

                    <% if (currentPage < totalPages) { %>
                        <a href="?page=<%= currentPage + 1 %>&titulo=<%= typeof titulo !== 'undefined' ? titulo : '' %>" class="btn btn-outline-secondary">Próxima</a>
                        <a href="?page=<%= totalPages %>&titulo=<%= typeof titulo !== 'undefined' ? titulo : '' %>" class="btn btn-outline-secondary" aria-label="Ir para última página">Última</a>
                    <% } %>
                </nav>
            </div>
        <% } %>

        <!-- Botão Voltar -->
        <div class="button-container">
            <a href="/simulados" class="btn btn-voltar btn-lg">
                <i class="bi bi-arrow-left"></i> Voltar ao Menu Simulados
            </a>
        </div>
    </div>

    <!-- Modal Excluir -->
    <div class="modal fade" id="modal-excluir" tabindex="-1" role="dialog" aria-modal="true" aria-labelledby="modalExcluirLabel" aria-describedby="modalExcluirDesc">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="deleteAccountForm" action="" method="POST">
                    <p id="modalExcluirTexto" class="visually-hidden">
                        Este modal solicita confirmação para excluir um simulado. Esta ação é irreversível.
                    </p>
                    <h5 id="modalExcluirLabel" class="visually-hidden">Confirmar Exclusão</h5>
                    <div class="modal-header">
                        <h5 class="modal-title">Excluir Simulado</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                    </div>
                    <div class="modal-body">
                        <p>Você tem certeza que deseja excluir este simulado?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-danger" aria-label="Confirmar exclusão do simulado">Confirmar</button>
                        <button type="button" class="btn btn-secondary" aria-label="Cancelar exclusão do simulado" data-bs-dismiss="modal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Visualizar PDF -->
    <div class="modal fade" id="modal-imprimir" tabindex="-1" role="dialog" aria-modal="true" aria-labelledby="modalPdfLabel" aria-describedby="modalPdfDesc">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 id="modalPdfLabel" class="modal-title">Visualizar Simulado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body p-0" id="modalPdfDesc">
                    <iframe id="iframe-imprimir" src="" frameborder="0" style="width: 100%; height: 70vh;" title="Visualização do simulado em PDF"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/main.js"></script>
    <script src="/simulados/js/simulado/meus_simulados.js"></script>
</body>
</html>





